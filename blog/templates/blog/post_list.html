
{% extends "blog/base.html" %}

{% block title %}All Posts{% endblock %} 
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="fw-bold">All Blog Posts</h2>
  <a href="{% url 'blog:post_create' %}" class="btn btn-primary"
    >Create New Post</a
  >
</div>

<!-- SEARCH FORM -->
<form method="GET" action="" class="input-group mb-4">
  <input
    type="text"
    name="q"
    class="form-control"
    placeholder="Search..."
    value="{{ request.GET.q }}"
  />
  <button class="btn btn-outline-primary" type="submit">Search</button>
</form>

<!-- POSTS LIST -->
{% for post in page_obj %}
<div class="card shadow-sm mb-4">
  <div class="card-body">
    <h3 class="card-title mb-2">
      <a
        href="{% url 'blog:post_detail' post.slug %}"
        class="text-decoration-none text-primary"
      >
        {{ post.title }}
      </a>
    </h3>

    <p class="card-text text-muted">{{ post.body|truncatechars:120 }}</p>

    <div class="mb-2"><strong>Category:</strong> {{ post.category.name }}</div>

    <div class="mb-3">
      <strong>Tags:</strong>
      {% for tag in post.tags.all %}
      <span class="badge bg-secondary">{{ tag.name }}</span>
      {% empty %}
      <span class="text-muted">No tags</span>
      {% endfor %}
    </div>
<p class="small text-muted">
    by {{ post.author.username }}
</p>


    <div>
      <a
        href="{% url 'blog:post_detail' post.slug %}"
        class="btn btn-sm btn-outline-success me-2"
        >View</a
      >
      <a
        href="{% url 'blog:post_edit' post.slug %}"
        class="btn btn-sm btn-outline-warning me-2"
        >Edit</a
      >
      <a
        href="{% url 'blog:post_delete' post.slug %}"
        class="btn btn-sm btn-outline-danger"
        >Delete</a
      >
    </div>
  </div>
</div>
{% endfor %}

<!-- PAGINATION -->
<nav>
  <ul class="pagination">
    {% if page_obj.has_previous %}
    <li class="page-item">
      <a class="page-link" href="?page={{ page_obj.previous_page_number }}"
        >Previous</a
      >
    </li>
    {% endif %}

    <li class="page-item disabled">
      <span class="page-link">
        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
      </span>
    </li>

    {% if page_obj.has_next %}
    <li class="page-item">
      <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
    </li>
    {% endif %}
  </ul>
</nav>

<!-- CATEGORY FILTER -->
<h4 class="mt-5">Filter by Category:</h4>
<ul class="list-group mb-4">
  {% for category in categories %}
  <li class="list-group-item">
    <a href="?category={{ category.slug }}" class="text-decoration-none"
      >{{ category.name }}</a
    >
  </li>
  {% endfor %}
</ul>

<!-- TAG FILTER -->
<h4>Filter by Tag:</h4>
<ul class="list-group">
  {% for tag in tags %}
  <li class="list-group-item">
    <a href="?tag={{ tag.slug }}" class="text-decoration-none"
      >{{ tag.name }}</a
    >
  </li>
  {% endfor %}
</ul>

{% endblock %}
